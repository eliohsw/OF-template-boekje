\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{packages/set-theorems}[2026/01/07 v0.3 Theorem-like Environments Settings]

\RequirePackage{amsthm}
\RequirePackage[most]{tcolorbox}
\RequirePackage{xeCJK}
\RequirePackage{setspace}

\RequirePackage{etoolbox}
\RequirePackage{xparse}

\newcommand{\mytheoremLang}{}
\newcommand{\myproofLang}{}

\DeclareOption{en}{
  \xdef\mytheoremLang{en}
  \xdef\myproofLang{lat}
}
\DeclareOption{de}{
  \xdef\mytheoremLang{de}
  \xdef\myproofLang{lat}
}
\DeclareOption{tw}{
  \xdef\mytheoremLang{tw}
  \xdef\myproofLang{zh}
}
\DeclareOption{cn}{
  \xdef\mytheoremLang{cn}
  \xdef\myproofLang{zh}
}

\ProcessOptions\relax

% Modified from amsthm.sty
% Additional proof styling inspired by: https://tex.stackexchange.com/a/659956
\makeatletter
\newenvironment{proofsol}[1][\proofname]{\par
  \normalfont \topsep6\p@\@plus6\p@\relax
  \trivlist
  \item[\hskip\labelsep
        \itshape
    #1\@addpunct{.}]\ignorespaces
}{%
  \endtrivlist\@endpefalse
}
\renewcommand\qedhere{} % to ensure code portability
\makeatother

{
  \message{Preset}
  \xdef\axname{Axiom}
  \xdef\cjname{Conjecture}
  \xdef\corname{Corollary}
  \xdef\dfname{Definition}
  \xdef\exname{Example}
  \xdef\exsname{Exercise}
  \xdef\lmname{Lemma}
  \xdef\ppname{Property}
  \xdef\prname{Problem}
  \xdef\prpname{Proposition}
  \xdef\thrmname{Theorem}
  \xdef\hintname{Hint}
  \xdef\rmkname{Remark}

  \xdef\pfname{Proof}
  \xdef\solname{Solution}
}

\def\theoremlangen{
  \message{Set Language: English}
  \xdef\axname{Axiom}
  \xdef\cjname{Conjecture}
  \xdef\corname{Corollary}
  \xdef\dfname{Definition}
  \xdef\exname{Example}
  \xdef\exsname{Exercise}
  \xdef\lmname{Lemma}
  \xdef\ppname{Property}
  \xdef\prname{Problem}
  \xdef\prpname{Proposition}
  \xdef\thrmname{Theorem}
  \xdef\hintname{Hint}
  \xdef\rmkname{Remark}

  \xdef\pfname{Proof}
  \xdef\solname{Solution}
}
\def\theoremlangtw{
  \message{Set Language: Chinese (Traditional)}
  \xdef\axname{公理}
  \xdef\cjname{猜想}
  \xdef\corname{推論}
  \xdef\dfname{定義}
  \xdef\exname{範例}
  \xdef\exsname{練習}
  \xdef\lmname{引理}
  \xdef\ppname{性質}
  \xdef\prname{問題}
  \xdef\prpname{命題}
  \xdef\thrmname{定理}
  \xdef\hintname{提示}
  \xdef\rmkname{注}

  \xdef\pfname{證明}
  \xdef\solname{解答}
}
\def\theoremlangcn{
  \message{Set Language: Chinese (Simplified)}
  \xdef\axname{公理}
  \xdef\cjname{猜想}
  \xdef\corname{推论}
  \xdef\dfname{定义}
  \xdef\exname{范例}
  \xdef\exsname{练习}
  \xdef\lmname{引理}
  \xdef\ppname{性质}
  \xdef\prname{问题}
  \xdef\prpname{命题}
  \xdef\thrmname{定理}
  \xdef\hintname{提示}
  \xdef\rmkname{注}

  \xdef\pfname{证明}
  \xdef\solname{解答}
}
\def\theoremlangde{
  \message{Set Language: German}
  \xdef\axname{Axiom}
  \xdef\cjname{Vermutung}
  \xdef\corname{Korollar}
  \xdef\dfname{Definition}
  \xdef\exname{Beispiel}      
  \xdef\exsname{Übung}
  \xdef\lmname{Lemma}
  \xdef\ppname{Merkmal}
  \xdef\prname{Problem}
  \xdef\prpname{Aussage}
  \xdef\thrmname{Satz}
  \xdef\hintname{Hinweis}
  \xdef\rmkname{Bemerkung}

  \xdef\pfname{Beweis}
  \xdef\solname{Lösung}

  \renewcommand*{\proofname}{Beweis}
}

\def\prooflanglat{
  \message{Proof Environment Script: Latin}

  \NewDocumentEnvironment{pf}{O{black}}{
    \AtBeginEnvironment{proof}{\color{##1}}
    \begin{proof}[\pfname]
  }{
    \end{proof}
  }
  \NewDocumentEnvironment{sol}{O{black}}{
    \AtBeginEnvironment{proofsol}{\color{##1}}
    \begin{proofsol}[\solname]
    \renewcommand{\qedsymbol}{}
  }{
    \end{proofsol}
  }
}
\def\prooflangzh{
  \message{Proof Environment Script: Chinese}

  \NewDocumentEnvironment{pf}{O{black}}{
    \AtBeginEnvironment{proof}{\color{##1}}
    \begin{proof}[\upshape\bfseries\pfname]
  }{
    \end{proof}
  }
  \NewDocumentEnvironment{sol}{O{black}}{
    \AtBeginEnvironment{proofsol}{\color{##1}}
    \begin{proofsol}[\upshape\bfseries\solname]
    \renewcommand{\qedsymbol}{}
  }{
    \end{proofsol}
  }
}

\csname theoremlang\mytheoremLang \endcsname 
\csname prooflang\myproofLang \endcsname

\tcbuselibrary{theorems}
\tcbuselibrary{breakable}

\makeatletter
\@ifclassloaded{beamer}{
  \def\TheoremHeadFont{\sffamily\sbseries}
  \def\TheoremHeadColor{\color{beamer@blendedblue}}
  \def\TheoremExtraSpace{~}
}{
  \def\TheoremHeadFont{\rmfamily\bfseries}
  \def\TheoremHeadColor{\color{black}}
  \def\TheoremExtraSpace{}
}
\makeatother

\tcbset{
  theoremstretch/.style={
    fontupper=\setstretch{1.33}\selectfont,
    fontlower=\setstretch{1.33}\selectfont,
  },
  theoremstyle/.style={
    theoremstretch,
    enhanced jigsaw, empty, opacityback=0, sharp corners=all,
    fonttitle=\TheoremHeadFont\TheoremHeadColor, titlerule=0pt, opacitybacktitle=0, toptitle=2mm,
    separator sign ={\enspace}, description delimiters={\mdseries(}{)},
    middle=4mm, lower separated=true, halign lower=justify,
    left=2mm, right=2mm,
    breakable, toprule at break=0mm, bottomrule at break=0mm, lines before break=1,
    before skip=12pt minus 4pt, after skip=12pt plus 4pt minus 4pt,
    borderline={0.75pt}{0pt}{black},
    segmentation engine=path,
    segmentation style={draw=black!50, line width=0.6pt, dashed}
  },
  normalstyle/.style={
    theoremstretch,
    enhanced jigsaw, empty, opacityback=0,
    fonttitle=\rmfamily\bfseries\color{black}, attach title to upper, after title={\hspace{1em}},
    separator sign ={}, description delimiters={\mdseries(}{)},
    middle=0mm, lower separated=true, halign lower=justify,
    left=0mm, right=0mm, boxsep=0mm,
    leftrule=0pt, rightrule=0pt, toprule=0pt, bottomrule=0pt,
    breakable, toprule at break=0mm, bottomrule at break=0mm,
    before skip=8pt, after skip=8pt plus 2.5pt,
  },
  geo_base/.style={
    sidebyside adapt= right, boxsep=0pt, sharp corners=all, blankest,
  },
  geo_c/.style={
    geo_base, sidebyside align=center seam,
  },
  geo_t/.style={
    geo_base, sidebyside align=top seam,
  },
  geo_b/.style={
    geo_base, sidebyside align=bottom seam,
  },
}

% Handouts and Teaching Materials
\newtcbtheorem[number within=section]{ex}{\bfseries \exname}{normalstyle}{ex}
\newtcbtheorem[use counter from=ex]{Ex}{\bfseries \exname\TheoremExtraSpace}{theoremstyle}{Ex}

\newtcbtheorem[number within=section]{exs}{\bfseries \exsname}{normalstyle}{exs}
\newtcbtheorem[use counter from=exs]{Exs}{\bfseries \exsname\TheoremExtraSpace}{theoremstyle}{Exs}

\newtcbtheorem[number within=section, crefname={\prname}{\prname s}]{prb}{\bfseries \prname}{normalstyle}{prb}
\newtcbtheorem[use counter from=prb, crefname={Problem}{\prname s}]{Prb}{\bfseries \prname\TheoremExtraSpace}{theoremstyle}{Prb}

\newtcbtheorem{prbx}{\bfseries \prname}{normalstyle}{prbx}
\newtcbtheorem[use counter from=prbx]{Prbx}{\bfseries \prname\TheoremExtraSpace}{theoremstyle}{Prbx}


% Theorems
\newtcbtheorem[number within=section]{thm}{\bfseries \thrmname}{normalstyle}{thm}
\newtcbtheorem[use counter from=thm]{Thm}{\bfseries \thrmname\TheoremExtraSpace}{theoremstyle}{Thm}

\newtcbtheorem[use counter from=thm]{df}{\bfseries \dfname}{normalstyle}{df}
\newtcbtheorem[use counter from=thm]{Df}{\bfseries \dfname\TheoremExtraSpace}{theoremstyle}{Df}

\newtcbtheorem[use counter from=thm]{pp}{\bfseries \ppname}{normalstyle}{pp}
\newtcbtheorem[use counter from=thm]{Pp}{\bfseries \ppname\TheoremExtraSpace}{theoremstyle}{Pp}

\newtcbtheorem[use counter from=thm]{lm}{\bfseries \lmname}{normalstyle}{lm}
\newtcbtheorem[use counter from=thm]{Lm}{\bfseries \lmname\TheoremExtraSpace}{theoremstyle}{Lm}

\newtcbtheorem[use counter from=thm]{ax}{\bfseries \axname}{normalstyle}{ax}
\newtcbtheorem[use counter from=thm]{Ax}{\bfseries \axname\TheoremExtraSpace}{theoremstyle}{Ax}

\newtcbtheorem[use counter from=thm]{cj}{\bfseries \cjname}{normalstyle}{cj}
\newtcbtheorem[use counter from=thm]{Cj}{\bfseries \cjname\TheoremExtraSpace}{theoremstyle}{Cj}

\newtcbtheorem[use counter from=thm]{cor}{\bfseries \corname}{normalstyle}{cor}
\newtcbtheorem[use counter from=thm]{Cor}{\bfseries \corname\TheoremExtraSpace}{theoremstyle}{Cor}

\newtcbtheorem[use counter from=thm]{prp}{\bfseries \prpname}{normalstyle}{prp}
\newtcbtheorem[use counter from=thm]{Prp}{\bfseries \prpname\TheoremExtraSpace}{theoremstyle}{Prp}


\newenvironment{hint}{\noindent\textbf{\hintname .}\hspace{1ex}}{\hfill}
\newenvironment{rem}{\noindent\textbf{\rmkname .}\hspace{1ex}}{\hfill}

\tcbset{
  quotestyle/.style={
    empty, borderline west={1pt}{0pt}{black},
    left=1pt, right=0pt, top=0pt, bottom=0pt,
    fontupper=\small,
    code={
      \renewcommand{\baselinestretch}{1.2}
    }
  },
}

\newenvironment{Quote}[1][]{
  \begin{tcolorbox}[quotestyle, #1]
}{
  \end{tcolorbox}
}

\newenvironment{centre}
  {%
    \par    % End previous paragraph
    \begingroup
    \centering
  }
  {%
    \par    % End centered paragraph
    \endgroup
  }

% Highlight texts
\definecolor{highlightyellow}{rgb}{1,0.98,0.84}
\newtcbox{\hil}{
  colback=highlightyellow,
  size=small, frame empty, sharp corners=all, on line,
  left=2pt, right=2pt, top=2pt, bottom=2pt, boxsep=0pt,
}
