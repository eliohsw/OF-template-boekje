\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{packages/set-theorems}[2026/01/10 v0.5.2 Theorem-like Environments Settings]

\RequirePackage{iftex}
\ifXeTeX\else
  \PackageError{packages/set-theorems}
    {This package requires XeLaTeX (XeTeX engine)}
    {You are compiling with a non-XeTeX engine.\MessageBreak
     Please switch to XeLaTeX.}
\fi

\RequirePackage{amsthm}
\RequirePackage[most]{tcolorbox}
\RequirePackage{xeCJK}
\RequirePackage{setspace}

\RequirePackage{etoolbox}
\RequirePackage{xparse}
\RequirePackage{pgfkeys}

\newcommand{\mytheoremLang}{}
\newcommand{\myproofLang}{}

\DeclareOption{en}{%
  \xdef\mytheoremLang{en}%
  \xdef\myproofLang{lat}%
}
\DeclareOption{de}{%
  \xdef\mytheoremLang{de}%
  \xdef\myproofLang{lat}%
}
\DeclareOption{tw}{%
  \xdef\mytheoremLang{tw}%
  \xdef\myproofLang{zh}%
}
\DeclareOption{cn}{%
  \xdef\mytheoremLang{cn}%
  \xdef\myproofLang{zh}%
}

% Default: behave like [en] if the user passes no language option.
\ExecuteOptions{en}
\ProcessOptions\relax

% Modified from amsthm.sty
% Additional proof styling inspired by: https://tex.stackexchange.com/a/659956
\makeatletter
\newenvironment{proofsol}[1][\proofname]{\par
  \normalfont \topsep6\p@\@plus6\p@\relax
  \trivlist
  \item[\hskip\labelsep
        \itshape
    #1\@addpunct{.}]\ignorespaces
}{%
  \endtrivlist\@endpefalse
}
\renewcommand\qedhere{} % to ensure code portability
\makeatother

% Preset (English defaults)
\message{Preset}
\def\axname{Axiom}
\def\cjname{Conjecture}
\def\corname{Corollary}
\def\dfname{Definition}
\def\exname{Example}
\def\exsname{Exercise}
\def\lmname{Lemma}
\def\ppname{Property}
\def\prname{Problem}
\def\prnameplural{Problems}
\def\prpname{Proposition}
\def\thrmname{Theorem}
\def\hintname{Hint}
\def\rmkname{Remark}
\def\pfname{Proof}
\def\solname{Solution}

\pgfkeys{
  /settheorems/names/.is family,
  /settheorems/names,
  axname/.code       = {\def\axname{#1}},
  cjname/.code       = {\def\cjname{#1}},
  corname/.code      = {\def\corname{#1}},
  dfname/.code       = {\def\dfname{#1}},
  exname/.code       = {\def\exname{#1}},
  exsname/.code      = {\def\exsname{#1}},
  lmname/.code       = {\def\lmname{#1}},
  ppname/.code       = {\def\ppname{#1}},
  prname/.code       = {\def\prname{#1}},
  prnameplural/.code = {\def\prnameplural{#1}},
  prpname/.code      = {\def\prpname{#1}},
  thrmname/.code     = {\def\thrmname{#1}},
  hintname/.code     = {\def\hintname{#1}},
  rmkname/.code      = {\def\rmkname{#1}},
  pfname/.code       = {\def\pfname{#1}},
  solname/.code      = {\def\solname{#1}},
}

\pgfkeys{
  /settheorems/lang/en/.style={
    /settheorems/names/.cd,
    axname={Axiom},
    cjname={Conjecture},
    corname={Corollary},
    dfname={Definition},
    exname={Example},
    exsname={Exercise},
    lmname={Lemma},
    ppname={Property},
    prname={Problem},
    prnameplural={Problems},
    prpname={Proposition},
    thrmname={Theorem},
    hintname={Hint},
    rmkname={Remark},
    pfname={Proof},
    solname={Solution},
  },
  /settheorems/lang/tw/.style={
    /settheorems/names/.cd,
    axname={公理},
    cjname={猜想},
    corname={推論},
    dfname={定義},
    exname={範例},
    exsname={練習},
    lmname={引理},
    ppname={性質},
    prname={問題},
    prnameplural={問題},
    prpname={命題},
    thrmname={定理},
    hintname={提示},
    rmkname={注},
    pfname={證明},
    solname={解答},
  },
  /settheorems/lang/cn/.style={
    /settheorems/names/.cd,
    axname={公理},
    cjname={猜想},
    corname={推论},
    dfname={定义},
    exname={范例},
    exsname={练习},
    lmname={引理},
    ppname={性质},
    prname={问题},
    prnameplural={问题},
    prpname={命题},
    thrmname={定理},
    hintname={提示},
    rmkname={注},
    pfname={证明},
    solname={解答},
  },
  /settheorems/lang/de/.style={
    /settheorems/names/.cd,
    axname={Axiom},
    cjname={Vermutung},
    corname={Korollar},
    dfname={Definition},
    exname={Beispiel},
    exsname={\"Ubung},
    lmname={Lemma},
    ppname={Eigenschaft},
    prname={Problem},
    prnameplural={Probleme},
    prpname={Aussage},
    thrmname={Satz},
    hintname={Hinweis},
    rmkname={Bemerkung},
    pfname={Beweis},
    solname={L\"osung},
  },
}

\def\theoremlangen{%
  \message{Set Language: English}%
  \pgfkeys{/settheorems/lang/en}%
}
\def\theoremlangtw{%
  \message{Set Language: Chinese (Traditional)}%
  \pgfkeys{/settheorems/lang/tw}%
}
\def\theoremlangcn{%
  \message{Set Language: Chinese (Simplified)}%
  \pgfkeys{/settheorems/lang/cn}%
}
\def\theoremlangde{%
  \message{Set Language: German}%
  \pgfkeys{/settheorems/lang/de}%
  \renewcommand*{\proofname}{Beweis}%
}


\def\prooflanglat{%
  \message{Proof Environment Script: Latin}

  \NewDocumentEnvironment{pf}{O{black}}{%
    \begingroup
      \color{##1}%
      \begin{proof}[\pfname]%
  }{%
      \end{proof}%
    \endgroup
  }%

  \NewDocumentEnvironment{sol}{O{black}}{%
    \begingroup
      \color{##1}%
      \renewcommand{\qedsymbol}{}%
      \begin{proofsol}[\solname]%
  }{%
      \end{proofsol}%
    \endgroup
  }%
}

\def\prooflangzh{%
  \message{Proof Environment Script: Chinese}

  \NewDocumentEnvironment{pf}{O{black}}{%
    \begingroup
      \color{##1}%
      \begin{proof}[\upshape\bfseries\pfname]%
  }{%
      \end{proof}%
    \endgroup
  }%

  \NewDocumentEnvironment{sol}{O{black}}{%
    \begingroup
      \color{##1}%
      \renewcommand{\qedsymbol}{}%
      \begin{proofsol}[\upshape\bfseries\solname]%
  }{%
      \end{proofsol}%
    \endgroup
  }%
}

\csname theoremlang\mytheoremLang\endcsname
\csname prooflang\myproofLang\endcsname


\tcbuselibrary{theorems}
\tcbuselibrary{breakable}

% If cleveref is not loaded, tcolorbox's theorem option 'crefname' would
% otherwise trigger an undefined \crefname. Provide harmless fallbacks.
\providecommand{\crefname}[3]{}
\providecommand{\Crefname}[3]{}

\makeatletter
\@ifclassloaded{beamer}{%
  \def\TheoremHeadFont{\sffamily\sbseries}
  \def\TheoremHeadColor{\color{beamer@blendedblue}}
  \def\TheoremExtraSpace{~}
}{%
  \def\TheoremHeadFont{\rmfamily\bfseries}
  \def\TheoremHeadColor{\color{black}}
  \def\TheoremExtraSpace{}
}
\makeatother

\tcbset{
  theoremstretch/.style={
    fontupper=\setstretch{1.33}\selectfont,
    fontlower=\setstretch{1.33}\selectfont,
  },
  theoremstyle/.style={
    theoremstretch,
    enhanced jigsaw, empty, opacityback=0, sharp corners=all,
    fonttitle=\TheoremHeadFont\TheoremHeadColor, titlerule=0pt, opacitybacktitle=0, toptitle=2mm,
    separator sign ={\enspace}, description delimiters={\mdseries(}{)},
    middle=4mm, lower separated=true, halign lower=justify,
    left=2mm, right=2mm,
    breakable, toprule at break=0mm, bottomrule at break=0mm, lines before break=1,
    before skip=12pt minus 4pt, after skip=12pt plus 4pt minus 4pt,
    borderline={0.75pt}{0pt}{black},
    segmentation engine=path,
    segmentation style={draw=black!50, line width=0.6pt, dashed}
  },
  normalstyle/.style={
    theoremstretch,
    enhanced jigsaw, empty, opacityback=0,
    fonttitle=\rmfamily\bfseries\color{black}, attach title to upper, after title={\hspace{1em}},
    separator sign ={}, description delimiters={\mdseries(}{)},
    middle=0mm, lower separated=true, halign lower=justify,
    left=0mm, right=0mm, boxsep=0mm,
    leftrule=0pt, rightrule=0pt, toprule=0pt, bottomrule=0pt,
    breakable, toprule at break=0mm, bottomrule at break=0mm,
    before skip=8pt, after skip=8pt plus 2.5pt,
  },
  geo_base/.style={
    sidebyside adapt= right, boxsep=0pt, sharp corners=all, blankest,
  },
  geo_c/.style={
    geo_base, sidebyside align=center seam,
  },
  geo_t/.style={
    geo_base, sidebyside align=top seam,
  },
  geo_b/.style={
    geo_base, sidebyside align=bottom seam,
  },
}

\newtcbtheorem[number within=section]{ex}{\bfseries \exname}{normalstyle}{ex}
\newtcbtheorem[use counter from=ex]{Ex}{\bfseries \exname\TheoremExtraSpace}{theoremstyle}{Ex}

\newtcbtheorem[number within=section]{exs}{\bfseries \exsname}{normalstyle}{exs}
\newtcbtheorem[use counter from=exs]{Exs}{\bfseries \exsname\TheoremExtraSpace}{theoremstyle}{Exs}

\newtcbtheorem[number within=section, crefname={\prname}{\prnameplural}]{prb}{\bfseries \prname}{normalstyle}{prb}
\newtcbtheorem[use counter from=prb, crefname={\prname}{\prnameplural}]{Prb}{\bfseries \prname\TheoremExtraSpace}{theoremstyle}{Prb}

\newtcbtheorem{prbx}{\bfseries \prname}{normalstyle}{prbx}
\newtcbtheorem[use counter from=prbx]{Prbx}{\bfseries \prname\TheoremExtraSpace}{theoremstyle}{Prbx}

\newtcbtheorem[number within=section]{thm}{\bfseries \thrmname}{normalstyle}{thm}
\newtcbtheorem[use counter from=thm]{Thm}{\bfseries \thrmname\TheoremExtraSpace}{theoremstyle}{Thm}

\newtcbtheorem[use counter from=thm]{df}{\bfseries \dfname}{normalstyle}{df}
\newtcbtheorem[use counter from=thm]{Df}{\bfseries \dfname\TheoremExtraSpace}{theoremstyle}{Df}

\newtcbtheorem[use counter from=thm]{pp}{\bfseries \ppname}{normalstyle}{pp}
\newtcbtheorem[use counter from=thm]{Pp}{\bfseries \ppname\TheoremExtraSpace}{theoremstyle}{Pp}

\newtcbtheorem[use counter from=thm]{lm}{\bfseries \lmname}{normalstyle}{lm}
\newtcbtheorem[use counter from=thm]{Lm}{\bfseries \lmname\TheoremExtraSpace}{theoremstyle}{Lm}

\newtcbtheorem[use counter from=thm]{ax}{\bfseries \axname}{normalstyle}{ax}
\newtcbtheorem[use counter from=thm]{Ax}{\bfseries \axname\TheoremExtraSpace}{theoremstyle}{Ax}

\newtcbtheorem[use counter from=thm]{cj}{\bfseries \cjname}{normalstyle}{cj}
\newtcbtheorem[use counter from=thm]{Cj}{\bfseries \cjname\TheoremExtraSpace}{theoremstyle}{Cj}

\newtcbtheorem[use counter from=thm]{cor}{\bfseries \corname}{normalstyle}{cor}
\newtcbtheorem[use counter from=thm]{Cor}{\bfseries \corname\TheoremExtraSpace}{theoremstyle}{Cor}

\newtcbtheorem[use counter from=thm]{prp}{\bfseries \prpname}{normalstyle}{prp}
\newtcbtheorem[use counter from=thm]{Prp}{\bfseries \prpname\TheoremExtraSpace}{theoremstyle}{Prp}


\newenvironment{hint}{\noindent\textbf{\hintname .}\hspace{1ex}}{\hfill}
\newenvironment{rem}{\noindent\textbf{\rmkname .}\hspace{1ex}}{\hfill}

\tcbset{
  quotestyle/.style={
    empty, borderline west={1pt}{0pt}{black},
    left=1pt, right=0pt, top=0pt, bottom=0pt,
    fontupper=\small,
    code={
      \renewcommand{\baselinestretch}{1.2}
    }
  },
}

\newenvironment{Quote}[1][]{
  \begin{tcolorbox}[quotestyle, #1]
}{
  \end{tcolorbox}
}

\newenvironment{centre}
  {%
    \par
    \begingroup
    \centering
  }
  {%
    \par
    \endgroup
  }

\definecolor{highlightyellow}{rgb}{1,0.98,0.84}
\newtcbox{\hil}{
  colback=highlightyellow,
  size=small, frame empty, sharp corners=all, on line,
  left=2pt, right=2pt, top=2pt, bottom=2pt, boxsep=0pt,
}
