\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{packages/set-theorems}[2026/01/10 v0.5.3 Theorem-like Environments Settings]

\RequirePackage{iftex}
\ifXeTeX\else
  \PackageError{packages/set-theorems}
    {This package requires XeLaTeX (XeTeX engine)}
    {You are compiling with a non-XeTeX engine.\MessageBreak
     Please switch to XeLaTeX.}
\fi

\RequirePackage{amsthm}
\RequirePackage[most]{tcolorbox}
\RequirePackage{xeCJK}
\RequirePackage{setspace}

\RequirePackage{etoolbox}
\RequirePackage{xparse}
\RequirePackage{pgfkeys}

\newcommand{\mytheoremLang}{}
\newcommand{\myproofLang}{}

\DeclareOption{en}{%
  \xdef\mytheoremLang{en}%
  \xdef\myproofLang{lat}%
}
\DeclareOption{de}{%
  \xdef\mytheoremLang{de}%
  \xdef\myproofLang{lat}%
}
\DeclareOption{tw}{%
  \xdef\mytheoremLang{tw}%
  \xdef\myproofLang{zh}%
}
\DeclareOption{cn}{%
  \xdef\mytheoremLang{cn}%
  \xdef\myproofLang{zh}%
}

% Default: behave like [en] if the user passes no language option.
\ExecuteOptions{en}
\ProcessOptions\relax

% Modified from amsthm.sty
% Additional proof styling inspired by: https://tex.stackexchange.com/a/659956
\makeatletter
\newenvironment{proofsol}[1][\proofname]{\par
  \normalfont \topsep6\p@\@plus6\p@\relax
  \trivlist
  \item[\hskip\labelsep
        \itshape
    #1\@addpunct{.}]\ignorespaces
}{%
  \endtrivlist\@endpefalse
}
\renewcommand\qedhere{} % to ensure code portability
\makeatother

% Preset (English defaults)
\message{Preset}
\def\axname{Axiom}
\def\cjname{Conjecture}
\def\corname{Corollary}
\def\dfname{Definition}
\def\exname{Example}
\def\exsname{Exercise}
\def\lmname{Lemma}
\def\ppname{Property}
\def\prname{Problem}
\def\prnameplural{Problems}
\def\prpname{Proposition}
\def\thrmname{Theorem}
\def\hintname{Hint}
\def\rmkname{Remark}
\def\pfname{Proof}
\def\solname{Solution}
\def\axnameplural{Axioms}
\def\cjnameplural{Conjectures}
\def\cornameplural{Corollaries}
\def\dfnameplural{Definitions}
\def\exnameplural{Examples}
\def\exsnameplural{Exercises}
\def\lmnameplural{Lemmas}
\def\ppnameplural{Properties}
\def\prpnameplural{Propositions}
\def\thrmnameplural{Theorems}

\pgfkeys{
  /settheorems/names/.is family,
  /settheorems/names,
  axname/.code       = {\def\axname{#1}},
  cjname/.code       = {\def\cjname{#1}},
  corname/.code      = {\def\corname{#1}},
  dfname/.code       = {\def\dfname{#1}},
  exname/.code       = {\def\exname{#1}},
  exsname/.code      = {\def\exsname{#1}},
  lmname/.code       = {\def\lmname{#1}},
  ppname/.code       = {\def\ppname{#1}},
  prname/.code       = {\def\prname{#1}},
  prnameplural/.code = {\def\prnameplural{#1}},
  axnameplural/.code = {\def\axnameplural{#1}},
  cjnameplural/.code = {\def\cjnameplural{#1}},
  cornameplural/.code = {\def\cornameplural{#1}},
  dfnameplural/.code = {\def\dfnameplural{#1}},
  exnameplural/.code = {\def\exnameplural{#1}},
  exsnameplural/.code = {\def\exsnameplural{#1}},
  lmnameplural/.code = {\def\lmnameplural{#1}},
  ppnameplural/.code = {\def\ppnameplural{#1}},
  prpnameplural/.code = {\def\prpnameplural{#1}},
  thrmnameplural/.code = {\def\thrmnameplural{#1}},
  prpname/.code      = {\def\prpname{#1}},
  thrmname/.code     = {\def\thrmname{#1}},
  hintname/.code     = {\def\hintname{#1}},
  rmkname/.code      = {\def\rmkname{#1}},
  pfname/.code       = {\def\pfname{#1}},
  solname/.code      = {\def\solname{#1}},
}

\pgfkeys{
  /settheorems/lang/en/.style={
    /settheorems/names/.cd,
    axname={Axiom},
    cjname={Conjecture},
    corname={Corollary},
    dfname={Definition},
    exname={Example},
    exsname={Exercise},
    lmname={Lemma},
    ppname={Property},
    prname={Problem},
    prnameplural={Problems},
    axnameplural={Axioms},
    cjnameplural={Conjectures},
    cornameplural={Corollaries},
    dfnameplural={Definitions},
    exnameplural={Examples},
    exsnameplural={Exercises},
    lmnameplural={Lemmas},
    ppnameplural={Properties},
    prpnameplural={Propositions},
    thrmnameplural={Theorems},
    prpname={Proposition},
    thrmname={Theorem},
    hintname={Hint},
    rmkname={Remark},
    pfname={Proof},
    solname={Solution},
  },
  /settheorems/lang/tw/.style={
    /settheorems/names/.cd,
    axname={公理},
    cjname={猜想},
    corname={推論},
    dfname={定義},
    exname={例},
    exsname={習題},
    lmname={引理},
    ppname={性質},
    prname={問題},
    prnameplural={問題},
    axnameplural={公理},
    cjnameplural={猜想},
    cornameplural={推論},
    dfnameplural={定義},
    exnameplural={例},
    exsnameplural={習題},
    lmnameplural={引理},
    ppnameplural={性質},
    prpnameplural={命題},
    thrmnameplural={定理},
    prpname={命題},
    thrmname={定理},
    hintname={提示},
    rmkname={注},
    pfname={證明},
    solname={解答},
  },
  /settheorems/lang/cn/.style={
    /settheorems/names/.cd,
    axname={公理},
    cjname={猜想},
    corname={推论},
    dfname={定义},
    exname={例},
    exsname={习题},
    lmname={引理},
    ppname={性质},
    prname={问题},
    prnameplural={问题},
    axnameplural={公理},
    cjnameplural={猜想},
    cornameplural={推论},
    dfnameplural={定义},
    exnameplural={例},
    exsnameplural={习题},
    lmnameplural={引理},
    ppnameplural={性质},
    prpnameplural={命题},
    thrmnameplural={定理},
    prpname={命题},
    thrmname={定理},
    hintname={提示},
    rmkname={注},
    pfname={证明},
    solname={解答},
  },
  /settheorems/lang/de/.style={
    /settheorems/names/.cd,
    axname={Axiom},
    cjname={Vermutung},
    corname={Korollar},
    dfname={Definition},
    exname={Beispiel},
    exsname={\"Ubung},
    lmname={Lemma},
    ppname={Eigenschaft},
    prname={Problem},
    prnameplural={Probleme},
    axnameplural={Axiome},
    cjnameplural={Vermutungen},
    cornameplural={Korollare},
    dfnameplural={Definitionen},
    exnameplural={Beispiele},
    exsnameplural={\"Ubungen},
    lmnameplural={Lemmata},
    ppnameplural={Eigenschaften},
    prpnameplural={Propositionen},
    thrmnameplural={S\"atze},
    prpname={Proposition},
    thrmname={Satz},
    hintname={Hinweis},
    rmkname={Bemerkung},
    pfname={Beweis},
    solname={L\"osung},
  },
}

\def\theoremlangen{%
  \message{Set Language: English}%
  \pgfkeys{/settheorems/lang/en}%
}
\def\theoremlangtw{%
  \message{Set Language: Chinese (Traditional)}%
  \pgfkeys{/settheorems/lang/tw}%
}
\def\theoremlangcn{%
  \message{Set Language: Chinese (Simplified)}%
  \pgfkeys{/settheorems/lang/cn}%
}
\def\theoremlangde{%
  \message{Set Language: German}%
  \pgfkeys{/settheorems/lang/de}%
  \renewcommand*{\proofname}{Beweis}%
}


\def\prooflanglat{%
  \message{Proof Environment Script: Latin}

  \NewDocumentEnvironment{pf}{O{black}}{%
    \begingroup
      \color{##1}%
      \begin{proof}[\pfname]%
  }{%
      \end{proof}%
    \endgroup
  }%

  \NewDocumentEnvironment{sol}{O{black}}{%
    \begingroup
      \color{##1}%
      \renewcommand{\qedsymbol}{}%
      \begin{proofsol}[\solname]%
  }{%
      \end{proofsol}%
    \endgroup
  }%
}

\def\prooflangzh{%
  \message{Proof Environment Script: Chinese}

  \NewDocumentEnvironment{pf}{O{black}}{%
    \begingroup
      \color{##1}%
      \begin{proof}[\upshape\bfseries\pfname]%
  }{%
      \end{proof}%
    \endgroup
  }%

  \NewDocumentEnvironment{sol}{O{black}}{%
    \begingroup
      \color{##1}%
      \renewcommand{\qedsymbol}{}%
      \begin{proofsol}[\upshape\bfseries\solname]%
  }{%
      \end{proofsol}%
    \endgroup
  }%
}

\csname theoremlang\mytheoremLang\endcsname
\csname prooflang\myproofLang\endcsname


\tcbuselibrary{theorems}
\tcbuselibrary{breakable}

% If cleveref is not loaded, tcolorbox's theorem option 'crefname' would
% otherwise trigger an undefined \crefname. Provide harmless fallbacks.

\makeatletter
\@ifclassloaded{beamer}{%
  \def\TheoremHeadFont{\sffamily\sbseries}
  \def\TheoremHeadColor{\color{beamer@blendedblue}}
  \def\TheoremExtraSpace{~}
}{%
  \def\TheoremHeadFont{\rmfamily\bfseries}
  \def\TheoremHeadColor{\color{black}}
  \def\TheoremExtraSpace{}
}
\makeatother

\tcbset{
  theoremstretch/.style={
    fontupper=\setstretch{1.33}\selectfont,
    fontlower=\setstretch{1.33}\selectfont,
  },
  theoremstyle/.style={
    theoremstretch,
    enhanced jigsaw, empty, opacityback=0, sharp corners=all,
    fonttitle=\TheoremHeadFont\TheoremHeadColor, titlerule=0pt, opacitybacktitle=0, toptitle=2mm,
    separator sign ={\enspace}, description delimiters={\mdseries(}{)},
    middle=4mm, lower separated=true, halign lower=justify,
    left=2mm, right=2mm,
    breakable, toprule at break=0mm, bottomrule at break=0mm, lines before break=1,
    before skip=12pt minus 4pt, after skip=12pt plus 4pt minus 4pt,
    borderline={0.75pt}{0pt}{black},
    segmentation engine=path,
    segmentation style={draw=black!50, line width=0.6pt, dashed}
  },
  normalstyle/.style={
    theoremstretch,
    enhanced jigsaw, empty, opacityback=0,
    fonttitle=\rmfamily\bfseries\color{black}, attach title to upper, after title={\hspace{1em}},
    separator sign ={}, description delimiters={\mdseries(}{)},
    middle=0mm, lower separated=true, halign lower=justify,
    left=0mm, right=0mm, boxsep=0mm,
    leftrule=0pt, rightrule=0pt, toprule=0pt, bottomrule=0pt,
    breakable, toprule at break=0mm, bottomrule at break=0mm,
    before skip=8pt, after skip=8pt plus 2.5pt,
  },
  geo_base/.style={
    sidebyside adapt= right, boxsep=0pt, sharp corners=all, blankest,
  },
  geo_c/.style={
    geo_base, sidebyside align=center seam,
  },
  geo_t/.style={
    geo_base, sidebyside align=top seam,
  },
  geo_b/.style={
    geo_base, sidebyside align=bottom seam,
  },
}

\newtcbtheorem[number within=section]{ex}{\bfseries \exname}{normalstyle,label type=ex}{ex}
\newtcbtheorem[use counter from=ex]{Ex}{\bfseries \exname\TheoremExtraSpace}{theoremstyle,label type=Ex}{Ex}

\newtcbtheorem[number within=section]{exs}{\bfseries \exsname}{normalstyle,label type=exs}{exs}
\newtcbtheorem[use counter from=exs]{Exs}{\bfseries \exsname\TheoremExtraSpace}{theoremstyle,label type=Exs}{Exs}

\newtcbtheorem[number within=section]{prb}{\bfseries \prname}{normalstyle,label type=prb}{prb}
\newtcbtheorem[use counter from=prb]{Prb}{\bfseries \prname\TheoremExtraSpace}{theoremstyle,label type=Prb}{Prb}

\newtcbtheorem{prbx}{\bfseries \prname}{normalstyle,label type=prbx}{prbx}
\newtcbtheorem[use counter from=prbx]{Prbx}{\bfseries \prname\TheoremExtraSpace}{theoremstyle,label type=Prbx}{Prbx}

\newtcbtheorem[number within=section]{thm}{\bfseries \thrmname}{normalstyle,label type=thm}{thm}
\newtcbtheorem[use counter from=thm]{Thm}{\bfseries \thrmname\TheoremExtraSpace}{theoremstyle,label type=Thm}{Thm}

\newtcbtheorem[use counter from=thm]{df}{\bfseries \dfname}{normalstyle,label type=df}{df}
\newtcbtheorem[use counter from=thm]{Df}{\bfseries \dfname\TheoremExtraSpace}{theoremstyle,label type=Df}{Df}

\newtcbtheorem[use counter from=thm]{pp}{\bfseries \ppname}{normalstyle,label type=pp}{pp}
\newtcbtheorem[use counter from=thm]{Pp}{\bfseries \ppname\TheoremExtraSpace}{theoremstyle,label type=Pp}{Pp}

\newtcbtheorem[use counter from=thm]{lm}{\bfseries \lmname}{normalstyle,label type=lm}{lm}
\newtcbtheorem[use counter from=thm]{Lm}{\bfseries \lmname\TheoremExtraSpace}{theoremstyle,label type=Lm}{Lm}

\newtcbtheorem[use counter from=thm]{ax}{\bfseries \axname}{normalstyle,label type=ax}{ax}
\newtcbtheorem[use counter from=thm]{Ax}{\bfseries \axname\TheoremExtraSpace}{theoremstyle,label type=Ax}{Ax}

\newtcbtheorem[use counter from=thm]{cj}{\bfseries \cjname}{normalstyle,label type=cj}{cj}
\newtcbtheorem[use counter from=thm]{Cj}{\bfseries \cjname\TheoremExtraSpace}{theoremstyle,label type=Cj}{Cj}

\newtcbtheorem[use counter from=thm]{cor}{\bfseries \corname}{normalstyle,label type=cor}{cor}
\newtcbtheorem[use counter from=thm]{Cor}{\bfseries \corname\TheoremExtraSpace}{theoremstyle,label type=Cor}{Cor}

\newtcbtheorem[use counter from=thm]{prp}{\bfseries \prpname}{normalstyle,label type=prp}{prp}
\newtcbtheorem[use counter from=thm]{Prp}{\bfseries \prpname\TheoremExtraSpace}{theoremstyle,label type=Prp}{Prp}
\makeatletter
% Cleveref needs the label types registered before any \cref/\Cref usage.
% Do it immediately if cleveref is already loaded; otherwise defer to begin document.
\newcommand*\settheorems@declarecrefnames{%
  \crefname{ex}{\exname}{\exnameplural}%
  \Crefname{ex}{\exname}{\exnameplural}%
  \crefname{Ex}{\exname}{\exnameplural}%
  \Crefname{Ex}{\exname}{\exnameplural}%
  \crefname{exs}{\exsname}{\exsnameplural}%
  \Crefname{exs}{\exsname}{\exsnameplural}%
  \crefname{Exs}{\exsname}{\exsnameplural}%
  \Crefname{Exs}{\exsname}{\exsnameplural}%
  \crefname{prb}{\prname}{\prnameplural}%
  \Crefname{prb}{\prname}{\prnameplural}%
  \crefname{Prb}{\prname}{\prnameplural}%
  \Crefname{Prb}{\prname}{\prnameplural}%
  \crefname{prbx}{\prname}{\prnameplural}%
  \Crefname{prbx}{\prname}{\prnameplural}%
  \crefname{Prbx}{\prname}{\prnameplural}%
  \Crefname{Prbx}{\prname}{\prnameplural}%
  \crefname{thm}{\thrmname}{\thrmnameplural}%
  \Crefname{thm}{\thrmname}{\thrmnameplural}%
  \crefname{Thm}{\thrmname}{\thrmnameplural}%
  \Crefname{Thm}{\thrmname}{\thrmnameplural}%
  \crefname{df}{\dfname}{\dfnameplural}%
  \Crefname{df}{\dfname}{\dfnameplural}%
  \crefname{Df}{\dfname}{\dfnameplural}%
  \Crefname{Df}{\dfname}{\dfnameplural}%
  \crefname{pp}{\ppname}{\ppnameplural}%
  \Crefname{pp}{\ppname}{\ppnameplural}%
  \crefname{Pp}{\ppname}{\ppnameplural}%
  \Crefname{Pp}{\ppname}{\ppnameplural}%
  \crefname{lm}{\lmname}{\lmnameplural}%
  \Crefname{lm}{\lmname}{\lmnameplural}%
  \crefname{Lm}{\lmname}{\lmnameplural}%
  \Crefname{Lm}{\lmname}{\lmnameplural}%
  \crefname{ax}{\axname}{\axnameplural}%
  \Crefname{ax}{\axname}{\axnameplural}%
  \crefname{Ax}{\axname}{\axnameplural}%
  \Crefname{Ax}{\axname}{\axnameplural}%
  \crefname{cj}{\cjname}{\cjnameplural}%
  \Crefname{cj}{\cjname}{\cjnameplural}%
  \crefname{Cj}{\cjname}{\cjnameplural}%
  \Crefname{Cj}{\cjname}{\cjnameplural}%
  \crefname{cor}{\corname}{\cornameplural}%
  \Crefname{cor}{\corname}{\cornameplural}%
  \crefname{Cor}{\corname}{\cornameplural}%
  \Crefname{Cor}{\corname}{\cornameplural}%
  \crefname{prp}{\prpname}{\prpnameplural}%
  \Crefname{prp}{\prpname}{\prpnameplural}%
  \crefname{Prp}{\prpname}{\prpnameplural}%
  \Crefname{Prp}{\prpname}{\prpnameplural}%
}

\@ifpackageloaded{cleveref}{%
  \settheorems@declarecrefnames
}{%
  \AtBeginDocument{\@ifpackageloaded{cleveref}{\settheorems@declarecrefnames}{}}%
}%
\makeatother


\newenvironment{hint}{\noindent\textbf{\hintname .}\hspace{1ex}}{\hfill}
\newenvironment{rem}{\noindent\textbf{\rmkname .}\hspace{1ex}}{\hfill}

\tcbset{
  quotestyle/.style={
    empty, borderline west={1pt}{0pt}{black},
    left=1pt, right=0pt, top=0pt, bottom=0pt,
    fontupper=\small,
    code={
      \renewcommand{\baselinestretch}{1.2}
    }
  },
}

\newenvironment{Quote}[1][]{
  \begin{tcolorbox}[quotestyle, #1]
}{
  \end{tcolorbox}
}

\newenvironment{centre}
  {%
    \par
    \begingroup
    \centering
  }
  {%
    \par
    \endgroup
  }

\definecolor{highlightyellow}{rgb}{1,0.98,0.84}
\newtcbox{\hil}{
  colback=highlightyellow,
  size=small, frame empty, sharp corners=all, on line,
  left=2pt, right=2pt, top=2pt, bottom=2pt, boxsep=0pt,
}