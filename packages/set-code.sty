\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{set-code}[2025/02/19 v0.4.0 Code Listing Settings]

% ========================================================================

\RequirePackage{fontspec}
\RequirePackage{xcolor}
\RequirePackage{tcolorbox}
\RequirePackage{listings}
\RequirePackage{minted}

\RequirePackage{kvoptions}

\SetupKeyvalOptions{
  family=set-code,    % "family" distinguishes your keys from others
  prefix=setcode@     % "prefix" is the control sequence prefix for the final macros
}

\DeclareStringOption[default]{style}

\ProcessKeyvalOptions*\relax

% If Makefile is not used, then uncomment the following lines
% \IfFileExists{_minted/style1.style.minted}{}{%
%   \immediate\write18{mkdir -p _minted && python3 script/mint_injector.py --style style1 --texfile \jobname.tex}%
% }

% ========================================================================

\ifx\setcode@style\@empty
  \relax
\else
  \edef\@temp{
    \noexpand\setminted{style=\setcode@style}
  }
  \@temp
\fi

\definecolor{custom-gray}{HTML}{B5B5AC}

\tcbuselibrary{listings, minted, skins, breakable}

\tcbset{listing engine=minted}

% The default font of the numbering in minted environments
\renewcommand{\theFancyVerbLine}{\Arial{\scriptsize\arabic{FancyVerbLine}}}

\setmintedinline{
  fontsize=\small,
  baselinestretch=1.15,
  highlightcolor=RoyalBlue1!12.5,
  % bgcolor=gray!8.75,
}

\setminted{
  fontsize=\footnotesize,
  baselinestretch=1.15,
  highlightcolor=RoyalBlue1!12.5,
}

\newtcblisting{codelisting}[2]{
  enhanced jigsaw, empty,
  listing only,
  minted language=#1,
  minted options={
    linenos,
    numbersep=12pt,
    breaklines,
    breaksymbol=\rule{0pt}{0pt},
    breaksymbolindent=2ex,
    fontsize=\footnotesize,
    obeytabs,
    tabsize=2,
    baselinestretch=1.15,
    highlightcolor=RoyalBlue1!12.5,
    #2
  },
  colback=gray!8.75, opacityback=0,
  sharp corners,
  borderline west={0.6pt}{0pt}{black},
  left=2.5pt, right=2.5pt,
  top=0pt, bottom=0pt,
  breakable,
  toprule at break=0mm, bottomrule at break=0mm,
}
